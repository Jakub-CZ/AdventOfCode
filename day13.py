from functools import partial

patterns = """
.#.####
##..#.#
##..#.#
.#.####
..#..#.
####.#.
#.#.#.#
.#..#.#
##.##..
#.#..#.
#.#....

.##.....#....#.
.##.....#....#.
..#.#..##....##
...###...#..#..
#..##.....##...
.#.#...#.####.#
#.#.....######.
##..###...##...
#..#..##..##..#
.##.#.#........
#..#..##..##..#
#####.#.##.###.
.#....##.#..#.#
..##.#...#..#..
#..####..#..#..

.##......##
.##......##
.#.#.##.#.#
#.########.
#.##....##.
#.######.#.
####....###
##.#.##.#.#
###......##
...######..
####.##.###

....#.###
#.#..####
##.......
##.......
#.#..####
....#.###
#..##.#.#
#.##...#.
#.##..#.#
####..#..
#.#.###.#
#.#..##.#
####..#..
#.##..#.#
#.##...#.

##.####.#
.###.####
###...###
###...###
.###.####
#..####.#
..###..#.
##..#..#.
####...#.
#....#.#.
...#.....
#....#.##
#.#.#.##.
#.#.#.##.
#....#.##
...#.....
#....#.#.

.##..#..#..#..#
#....##.##.##.#
......#..######
......#..######
#....##.##.##.#
.##..#..#..#..#
######..#.#.###
.#..#.....#.#..
#...#..#.#.##.#
.###....#..###.
.###....#..###.
#...#..#.#.##.#
.#..#.....#.#..
######..#.#.###
.#...#..#..#..#

.######.#.#..#.
#..##....##..##
#.#.#.###.#..#.
#.#.#.###.#..#.
#..##....##..##
.######...#..#.
#.#.#..#..####.
#.#...#########
.....###.##..##
.#.#....###..##
.#...#...#....#

#.##.#......#.#
#.##.#......#.#
..##.#.......#.
.##.##.##.##...
#.#.##...#.####
##...#.##.#.##.
.#..#.##.#.#..#
.#..#.##.#.#..#
##...#.##.#.##.
#...##...#.####
.##.##.##.##...
..##.#.......#.
#.##.#......#.#

..#..#..#..#.
##.#.####.#.#
####......###
#####.##.####
..#.#.##.#.#.
####..##..###
...#......#..
##.###..###..
...#..##..#..
##.##.##.##.#
##.###..###.#
####......###
..#.##..##.#.
##..........#
##.##....##.#

.#.#....#.#......
...##..##.......#
#..######..#.##..
.###....###.##...
.#.#.##.#.#..#...
..###..###.......
###..##..####.###
#..##..##..##.#..
....#.##....#...#
###.#..#.###.#.#.
#.#......#.##..#.
#.#......#.##..#.
###.#..#.###.#.#.

#.##..##...##..
##.#.#.####..##
##..#..#.#.##.#
##.###.##......
####...####..##
##.#.#.####..##
##.#.#.####..##
####...####..##
##.###.##......
##..#..#.#.##.#
##.#.#.####..##
#.##..##...##..
#...#.#########
.##.###.#.#..#.
......####.####

##..##.
.##....
.##....
##..##.
#.###.#
#.##..#
.######
.######
#.##..#
#.###.#
.#..##.

....#..
##.#.##
..#.#..
....###
##.#.##
##.####
###....
##.##..
....#..
.....##
#####..
##.....
....#.#
####.##
##..#..

.#.##.#.....#.#.#
###..###.#####...
###..###.#####...
.#.##.#.....#.#.#
.#....#..#.###...
#.#..#.#####..##.
#.####.##......#.
##.##.##.##.##..#
###...##.##....##
#.####.#####.####
##.##.##.##......
#########.#.####.
###..####..###...

#..####..#..#..##
###.##.####.#.##.
..######.....#.##
###.##.#####...#.
#.#....#.#.#....#
##.####.###.#.#..
###....###.#.#.##
###.##.####.#####
...#..#....##...#
...#..#....##...#
###.##.####.#####
###....###.#.#.##
##.####.###.###..
#.#....#.#.#....#
###.##.#####...#.

####..##.
####...##
.....###.
...######
######...
....#....
####..#.#
####..#.#
....#....
######...
...####.#
.....###.
####...##

#...#..#.
#...#..#.
####....#
#..######
...######
###......
...##..##
###.####.
#.#....#.

.####..
##.#.#.
##.#.#.
.####..
#..#..#
.....##
.#.#..#
..#.#.#
..#.#.#
.#.#..#
.....##
#..#..#
.#.##..

#.#.#....##..
.####.#.####.
.####.#..###.
#.#.#....##..
..#...###....
..#...###....
#.#.#....##..
.####.#..###.
.####.#.####.
#.#.#....##..
##.#.####...#
..#..#..#.##.
##.#######..#
.##..####...#
###..##....##
.######.##...
.#..#.##..##.

......#
##...#.
.#....#
.#....#
.#...#.
......#
#..###.
...#..#
#.#..##
#.#...#
#..##.#
#..##.#
#.#...#
#.#..##
...#..#
#..###.
......#

##..#.#....
####..#.##.
#.#.#..####
..#....#..#
..#....#..#
#.#.#..####
####..#.##.
##..#.#....
####...###.
#....######
#...###...#
..#####..#.
..##.###.#.
..##.###.#.
..###.#..#.

..........#.###
..######...##.#
.#......#......
#.##..##.#.....
##.####.##.#.##
#...##...###..#
#...##...###..#
##.####.##.#.##
#.##..##.#..#..

..#.......##.#.
#.#.#...####..#
.#..##.#.#.#.##
.#..##.#.#.#.##
#.#.#...####..#
..#.......##.#.
..#..#####....#
.#.#.#......###
.#.###......###

...#.##.#
....#..#.
#..##..##
...######
.#.#....#
.#.#....#
...######
#..##..##
....#..#.
#..#.##.#
###..##..

.#.####.#....
#.#....#.#...
###....##.###
#.##..##.#.##
.#.#..#.#.###
#.######.#...
#.##..##.####

##.#.##
#......
#...#.#
####.##
.#.#..#
...####
...####
.#.#..#
####.##
#...#.#
#......
##.#.##
.#..#..
#..#..#
#.....#

#.########.#.
..##....##..#
..##....##..#
#.########.#.
.##..##..##.#
#.##....##.#.
.#.....#..#.#
...#.##.#....
#..........#.
.#...##...#..
.##.#..#.##..

.##..#..#.##.#.
#..#.##...##...
#######..####..
#######..####..
#..#.##...##...
.##..#..#.##.#.
.#.....#.#....#
......###.#..##
.......#.###.#.
####.##..#..#.#
....#.#.##.#..#
######.######..
....#..##.###..

##.#....#..
##.#...##..
.###.##.#.#
##.####....
...##....#.
..#....#.#.
.....##..##
.#..####...
.#..####...
.....##..##
..#....#.#.
...##....#.
##.####....
.###.##.#.#
##.#...##..

##.####.#
.#.####.#
.#.####.#
##..##..#
####..###
##.####.#
#.#....#.

...#..##.
......##.
#...#####
#..#.####
...######
.#.######
##...#..#
###..####
##..#....

###..###.
####.#.#.
..#..##.#
###.#...#
......##.
..###.###
..#...###
##..#.#.#
##.......
..#......
######...
#####...#
##..##.##
###....#.
###.#.###
#####..##
#####.###

..#..###...
..#...##...
##..###.##.
#.#..###..#
.####...##.
#.###.#.###
..##.....##
#.#..##.#.#
######.#.#.
.####..#..#
.##.##.....
..#......##
..#......##

..#...##...#..#
..####..####...
.#.#.#..#.#.#..
###.#.##.#.###.
..##.####.##...
#..###..###..#.
#....####....#.
..#.######.#...
..#.######.#...
#....####....#.
#..###..###..#.
..##.####.##...
###.#.##.#.###.
.#.#.#..#.#.#..
..####..####..#
..#...##...#..#
##.##.##.##.##.

.###..#.#
..#...#.#
##.####..
#..#.####
....##...
....##...
#..#.####
#..####..
..#...#.#
.###..#.#
.###..#.#

#..##..##...##...
........#########
##....###########
#.#..#.#.#.#..#.#
.##..##..##....##
###..############
#########...##...
.#.##.#.#########
..#..#..###....##
###..#####.#..#.#
.#.##.#..######.#
..#..#..#..#..#..
..####..##..##..#
#.####.##########
##.##.##.#.####.#
..####..#..#..#..
########...####..

..#.#....#.#..##.
###.###.##.###..#
##.#......#.##..#
#....####....#..#
.##.#....#.##.##.
.#....##....#.##.
....######.......
#....#..#....#..#
##.#.#..#.#.#####
#.#...##...#.####
#.##.####.##.#..#
#####.##.########
.##..#..#..##.##.
.###......###....
#..#.#..#.#..#..#

#.#.#.#.#.####.
...########..##
..#.###.###..##
..#.#.#.###..##
#...#..#...##..
.##..##########
#..#.....##..##

#.###..##.#......
#.###..##.#......
.#.#...#....#..#.
#.#####..###.....
#####......#.###.
....#.###.#...###
....##.#.#.##..#.
#.##.#...#...##.#
..##..#.#########
#.#..###.#..###.#
#.#..###.#..#####
..##..#.#########
#.##.#...#...##.#
....##.#.#.##..#.
....#.###.#...###
#####......#.###.
#.#####..###.....

......#
....#.#
#..#.#.
.#.####
.#.####
#..#.#.
....#.#
......#
.####.#

....#.##.##..##..
####..#.##.#.##.#
.#.....#.###....#
###.####.........
#.##.#.#..###..##
##.#.####.#######
####.##.#....##..
#######.#....##..
##.#.####.#######
#.##.#.#..###..##
###.####.........

###..#...##...#..
..#.####.##.####.
##.#..#......#..#
..#..#........#..
###.#.########.#.
##.#...######...#
###.############.
##.#.#..####..#.#
##..#.#.####.#.#.
..#...#..##..#...
###.#####..#####.
#.#.###.####.###.
##..###.####.###.

##.##.####..##.##
###..####..#..#..
#.####.##..##.#..
..####..#..#...#.
##.##.##....#...#
#.#..#.####.#.#..
............#...#
#..##..#...#..##.
#......#.##...##.
.#.##.#.###.##..#
##.##.####.####.#
##.##.####.####.#
.#.##.#.###.##..#
#......#.##...##.
#..##..#...##.##.
............#...#
#.#..#.####.#.#..

.##..###.####..#.
.###...####.###..
##...#..##.#.###.
##.##.#.##.##.#.#
##.##...##.##.#.#
#.##...#..##.##..
.###....#####.#..
..####.#..#..###.
..####.#..#..###.
.###....#####.#..
#.##...#..##.##..
##.##...##.##.#.#
##.##.#.##.##.#.#

##.##..###.
##.##.#..#.
......#...#
......#...#
##.##.#..#.
##.##..###.
###....#.#.
#.#..#..#..
#.##...#.#.
..####.###.
..####.##..
#.##...#.#.
#.#..#..#..
###....#.#.
##.##..###.
##.##.#..#.
......#...#

###.############.
...#.#.######.#.#
##.......##......
##.....#....#....
####....####....#
..##.##.#..#.##.#
...######..######
####.##..##..##.#
#...##..#..#..##.
..#.#.#..##..#.#.
.....#.#....#.#..
#####..#.##.#..##
...#..##....##..#
####...#.##.#...#
###.#..#....#..#.

....##..#.#..
....#...#####
....#...#.###
.##..#...#...
....###.####.
#..##.#.##...
####..#####..
#####..#.##..
####...##....
#####.#...###
#..###.####..
.##.####..###
####.###..###
....#...#....
.##...#######

...######
#.#..##..
.#.######
#...#####
..#######
#####..##
#.#.####.
.#...##..
.#..#..#.
#...#..#.
.###.##.#
..##.##.#
..##.##.#
.###.##.#
#...#..#.

##...#.
##...#.
.######
###...#
.#.#.#.
...#.#.
#..#.##
#..#.##
...#.#.
.#.#.#.
##....#
.######
##...#.

##..#..##
##.#.....
##...##..
#.###....
###..#.##
#####.###
##.####..
#####.###
....#.###
..##...##
..####...
..###....
...######
#######..
###..#...

####....#####
#####...#.##.
......#.##..#
....####.####
....##...#..#
#..#.#....#..
.....#...#..#
########.....
#######.#.##.
#..##..#.#..#
#..##.....##.
.....##.#.##.
.##.#.#.#.##.
########.####
#..#...#..##.

.#####.#.##
.#####.#.##
...#......#
.#.#..###.#
###.###.#.#
###..#...##
##.#####...
##..##..#.#
..##.####.#
#.#.#..####
#.#.#..####
..##.####.#
##..##..#.#
##.#####...
###..#...##
##..###.#.#
.#.#..###.#

##......#####
#..#..#..##.#
#.#.##.#.####
##..##..##..#
..#....#...##
###########..
..######..##.
#.....#..#..#
.##....##..##
###.##.###...
#........#..#
##..##..###..
##..##..###..

#.#..#.#..#.#..
#.##.#.#..#.#.#
#.##.#.#..#.#.#
#.#..#.#..#.#..
...#...#..#...#
...##..#..#..##
..#...#....#...
.##.#.######.#.
.....#......#..
#######....####
#.#.###.##.###.
##...#......#..
#.##.#.####.#.#
#.###..#..#..##
###..##....##..
#.###..#..##.##
#.#.....##.....

...#.#..#.#......
##..#....#..####.
#####....########
##.#......#.####.
#.#...##...#.##.#
##..........####.
#.##########.##.#
.#####..#.###..##
.############..##

..#.##..#
..#.##..#
.###..#..
##.#..##.
#...#.#..
###.#..#.
##.#.####
..#...#..
##.#....#
..###.#..
#.#.###.#
.#.#####.
...#....#
...#....#
.#.#####.
#.#.###.#
..###.#.#

..#...#.#
.#....#.#
#..#####.
..#####..
...##...#
#.##.....
#.##.....
...##...#
#.#####..
#..#####.
.#....#.#
..#...#.#
.#..#.##.
.#..#.##.
..#...#.#

.#.####.##.####
##.....#..#####
#.#.#......####
##.#.#.#..#####
.#.########.##.
#.....##....##.
.#..#....##.##.
#..#.#....##.##
##.###.####.##.
##.##....#.....
#.##.##.####..#
.##..###.#.....
.##..###.#.....

......#..#.
.......#..#
.......#..#
......#....
######.####
#.##.##....
#######.##.
######.#..#
######..#..
#########..
......####.
#.##.###...
######.#.##
##..##.#...
#######....
..##...####
.......##..

.##.#####..#.
##.#..#.#....
.#.###.##.#.#
##.###.....#.
..#..#.###..#
##..#.#....##
##..#.#....##
..#..#.###..#
##.###.....#.
.#.###.##.#.#
##.#..#.#....
.##..####..#.
.##..####..#.

#...#..##.#.#..
#.#..##.####.#.
#.#..##.####.#.
#...#..##.#.#..
.#.#...#..###.#
......#.....###
....##..#.#####
##...####.#.##.
#...#...##..###
...###.##..##.#
...##..##..##.#

###..####..
###..####..
##....#....
.####.###..
###.###.#..
##.###..###
....#.#..##
#.#..#..#..
..#...#####
.#.####....
##......##.

##.##.#.#..
###.#..##..
..##.##.##.
#.#..#.#.##
#.###....#.
#..#.#...##
...##.###.#
...##.###.#
#..#.#....#
#.###....#.
#.#..#.#.##
..##.##.##.
###.#..##..
##.##.#.#..
.###.#..##.
#.####..#.#
#.####..#.#

####....####...
...#....#...#..
..##....##.....
...##..##....##
....####....#..
#...####...#...
.#...##...#.###
.#........#....
.....##........
#..........#...
.#.#.##.#.#.###
##..#..#.###.##
.##......##..##
###.#..#.###.##
#...####...#...
..##....##..###
#.#.####.#.#...

####..#..
....####.
......##.
.##...###
.##...###
......#..
....####.
####..#..
.##.##.#.
.##..#.#.
#######.#
....###.#
######..#

#.##.#..#..
#.##.##.#..
#.##.##.#..
..##....#..
..##...#.#.
#....###.##
..##...##.#
.#..#..##.#
#.##.##...#

.#.########.#..
####.......###.
#.###.##.###.##
..#........#..#
...##....##....
###..#..#..###.
##.########.###
##.########.###
###..#..#..###.

...##.....#
.##..##....
..####..##.
#..##..#.##
#..##..#.#.
###..####..
.#..#.#.###
.##..##.#.#
##....#####
..#..#....#
##....##..#
.#.##.#.###
...##...##.
##....###..
##....###..
...##...##.
.#.##.#.###

#....######.#
#.##.#..#.#.#
.####.#...##.
#######.##...
##..#####.#..
......###...#
......###...#
##..##.##.#..
#######.##...
.####.#...##.
#.##.#..#.#.#
#....######.#
..##..###.#..

..####...##..
.##..##..##..
#.#..#.#....#
##....##....#
#.#..#.##..##
#.####.#.##.#
##.##..#.##.#
########....#
...##...####.

##.....
..#.##.
###.###
.#.####
.###..#
.###..#
.#.####

#....####.###
#....####.###
.#..#...##.##
#.##.#...####
.#..##..#....
.#..#.#...#..
.####...##...
#.##.#.#.#.#.
..##...#####.
##..##.##.##.
#....###.#..#
.#..#.#..##.#
.......#.#...
.#..#.#.####.
......#..#...
##..##..##.#.
.#..#..#.###.

#.#######.#.#..
..#.#...#...#..
#......#...#.##
##..##....###..
.#.##.###.#####
###..#.#..##...
###..#.#...#...
##.#.##.##..###
.####.##..#..#.
..#####...##.##
..#####...##.##
.####.##..#..#.
##.#.##.##..###
###..#.#...#...
###..#.#..##...

##.##.##.###.#..#
##.###.#..##..##.
.###..#.##..###.#
#.#...##.#####..#
..#.#.....#..####
#...#.#..####.##.
#.#...####.#.####
..#.#.#..##.#.##.
....##..##..#####
.#..##...#.###..#
.##.#..#..#.##..#
.##.#..#..#.##..#
.#..##...#.###..#
....##..##..#####
..#.#.#..##.#.##.

####...
#.#####
..#####
####...
#....##
.###.##
.#..#..
###.###
##...##
.###.##
#.#####

..######...
.#......#..
#....#...#.
##......###
.##....##.#
...####...#
.#.#..#.#.#
.#..##..#..
#........#.
#.#.##.#.##
.#.####.#.#
.#.#..#.#..
.#.####.#..
.#.####.#..
.#.#..#.#..

##.#......#.##.
##.#......#.##.
####......#####
###..#..#..###.
...#......#...#
#...#.##.#...#.
##....##....##.
##.###..###.##.
.###......##..#
...########....
###.#....#.###.
..###....###..#
#.#.#.##.#.#.#.

.######.######.##
.#.##.#...##...#.
##....####..####.
.##..##........##
#.#..#.#.####.#.#
##.##.###....###.
.#....#.#....#.#.
.#.##.#.#....#.#.
..#..#..######..#
########..##.####
...##............
#.####.#......#.#
..#..#..######..#

.#.##......
...##......
..#..##.#..
..#.#..###.
....#...#..
#.#..##..##
...##.#.###
..#.###..#.
..#.###..#.
...##.#.###
#.#..##..##
....#...#..
..#.#..###.

#..#.####.#..##
#..###..###..#.
#.#.#.##.#.#.##
##..#.##.#..###
.##.##..#..##..
..#..#..#..#...
##..#....#..###
.##.#....#.##.#
...#..##..#...#
....#....#....#
.....#..#......
..#.#....#.#...
..##......##...
..##......##...
..#.#....#.#...
.....#..#......
....#....#....#

.##..#.
.##..#.
#.#.###
..##...
.#...#.
#####..
#.#.###
#.#.###
#####..
.#...#.
...#...

###..#..###
.....#...##
......#.#..
..#.#...#..
...###.####
##.##...##.
..###...###
##...#.#..#
#.##.##..#.
..#...#.#..
...#.#..#..
...#.#..#..
..#...#.#..

.....##..
....#..#.
.....##..
#..#.##.#
####....#
.##......
#..###.##

.#..##.######
#.#..##.#.##.
#.#..##.#.##.
.#..##.######
.####..#.....
.#.#.#.#.#..#
####...#...#.

#..#...
...#...
.###.#.
..#.##.
..#.#.#
.##.##.
.##.##.
..#.#.#
..#.##.
.###.#.
...#...
#..#...
...###.
#....##
.######

.##...#.#
####....#
...####.#
#..#.####
.##.##.##
#####.#.#
....#####
.##.##.#.
.##..##.#
#..#.####
.##...##.
#..#..###
#..#..###

..#...#
..#...#
.######
.##.#.#
.#.#.#.
#...##.
......#
#...#.#
#...#.#
......#
#...##.
.#.#.#.
.##...#
.######
..#...#

###.##.
..##...
.#.#..#
.#.#...
..##...
###.##.
###...#
.#.....
#...#.#
...##.#
...##.#
#...#.#
.#.....
###...#
###.##.

....#..#.
##.######
##.#....#
..###..##
..#..##.#
.....##..
##.#.##.#
..##.##.#
###..##..

###..##.##.#.
###..##.##.##
######.#.#.##
####.#..#.#.#
...#.#.##.###
##..##.#.....
....##.#..##.
........#.#..
...#....#.##.
###.####.....
...##...#.###
####..#.###..
....#..#..##.
##.####...#.#
...#.......#.

..#.#..
..#####
..#####
..#.#..
##..#..
...#.##
.######
.###..#
.####.#
.######
...#.##

.####..####.#..##
##..#..#..###.#..
#...#..#...#.#.##
.#.##..##.#.##..#
#..#.##.#..#.....
.#..#..#..#......
.#.######.#..#...
##.##..##.##.#...
.###....###.#####

..###..#.##..
..###..#.#...
...#.#..#####
#####.###.#.#
...#.#..#.#.#
#####..###.#.
##.....##.#..

....##.
.#.####
.######
.#.#..#
#.##..#
...####
.######
#...##.
##..##.
#...##.
#...##.
.######
...####

##....##.
##...##..
##.####.#
..##..##.
..##..##.
##.##.#.#
##...##..
##....##.
....##.##
..#...###
...##.##.
...#...##
#####..#.

##.#.#.
#..#.#.
..#...#
##.#...
...#...
.###...
.#.###.
.#..#..
.#..#..
.#.###.
.###...
...#...
##.#...
..#...#
#..#.#.

.###....#
#..##..##
#.#######
#.#......
##...##..
..##....#
#....##..
###......
#.#.####.
....####.
#####..##
.##......
..##....#
####.##.#
.###.##.#

.##.##.##..##.##.
.##.#.########.#.
.##.####.##.####.
#..######..######
.......##..##....
..#..##########..
....#.##.##.##.#.
#..#.##.####.##.#
####..#......#..#

#..####..##..
.#..##..#..#.
.#......#..#.
..##..##....#
...#..#......
#..#..#..##..
.#......#..#.
#........##..
...####......
.###..###..##
...#..#......
#..####..##..
..#....#....#
#........##.#
.###..###..##

#.#..##..#.#.....
#.#..##..#.#.##..
...#.##.#...#..#.
.#........####.##
#.##.##.##.#...##
..#.####.#.....#.
####.##.######.##
###.#..#.###..###
..##.##.##...#..#
..##.##.##...#..#
###.#..#.###..###
""".strip().split("\n\n")


def have_n_differences(n: int, pairs: list[tuple[str, str]]):
    for a, b in pairs:
        for a0, b0 in zip(a, b):
            if a0 != b0:
                if (n := n - 1) < 0:
                    return False  # more differences than required
    return n == 0


def find_reflection(pattern: str, smudges=0):
    def find_by_rows(_rows: list[str]):
        for i in range(1, len(_rows)):
            if have_n_differences(smudges, zip(reversed(_rows[:i]), _rows[i:])):
                return i
        return 0

    rows = pattern.split()
    # transpose for the 2nd call -> process by columns
    return 100 * find_by_rows(rows) or find_by_rows(list(zip(*rows)))


if __name__ == '__main__':
    print(f"Summary of reflections: {sum(map(find_reflection, patterns))}")
    print(f"- with smudges: {sum(map(partial(find_reflection, smudges=1), patterns))}")
