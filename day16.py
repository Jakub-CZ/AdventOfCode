layout = r"""
\..............................................................-......-.............-........\-...............
./.........................-..-............................../..........|..|.-\..|.|.../.................-....
|......|...\./|....\............./-..........\|............./..../.....|....\.......................-....../..
.......-.....\.........\../............-.-.................|....-\.....\..\......|./..........................
................................./..-.................-\............/......|..../..|.....\|...................
.....|......../.....|...-.............../......\................................\........|.....\......./......
............\............|..........\......\...../......................|.........................\...........
...........................\.......-..|..../.............\........//.................../..-............|......
..................\......................./....-..../........./\.......|................./............/.\.....
.\......./..........\.......\./..--...|..............-..........\.\...../.../....../.-./........./....\.......
..../......./.........|...........................\....................|.............../|.../.../...\..\...../
...-.\|\.....-............................-........................\...............\....-..................../
........\....|.....-...-..|..\..-./..........|.............|..............................\...................
.....\......................................./...........-.........................-....................../...
....\...............................-...........\............\.........-|..-..|........../..-.....|.../......|
........\.......-./...-.../...................................-.......|........./............|.\..............
............\...........-.....\..|.......................|.......|.............\......./...........|..........
.|.....|...................-...|.................................../\....../..../..........|.............|./..
...............|......./......................../......................./.....-.............../.............\.
...\..-/.........-........................-............................/\.\.......-..|..............-.........
...-........./......\..\..............-............/.............-......-.........|................/........-.
............\..\...|.........|..................../\........../..\.....................\............../.......
........\.................................../..../..................|........-................................
...|.../............\-..-....\..|....|........-./.............................\...............................
......-.\.-......\......../.|..........\.|..../..\....................../..\/./...../--...................|...
.......\|............/...|...|.........../........../...........|........./...................................
\........\...........................-/.......................-............-..|......|..............\.........
......................../|............\.............../......|.-\..\.......|../...........-..............-....
.............................\.....-..............|...........|/...../.....-..................../.....-..-/.--
.|...........................-.........|....-/.-.....\.........../.........|......\..../.\.\...............|..
...................\.........................\...................|..../...........-..............-............
...............-.....-.......\.............|........../-.........../..........\.....|............|.../.....-..
..........|.-...................................-............|../.............................|../............
...|..........\.......\....\..........|........./.........-|-............|....................................
./\..../.......|........|....|......../............/............/................................|............
..........................\........................../........|.........................\\................-...
....../....|.../..\.-..|....././|-.....|........................................-.....................-.......
.\.-............./...|..../|........./|...........-\..|.................|.../......................./.........
.........|........../.........\.........../............../..............\....\..............-|................
....-...../...\...........................\.-......|........\...-...|..............|......|.\.....-...........
...-.............................-\.........-..../.\..........-..../......--............................\.....
.................-........|..................-.|................|....-....\...|....../....\...................
...\.........\..........|................/..........|....\./..................../-............./..............
/........\....-......-.-|...........|../........\.|.......|...........|.................-.............|.......
......../....../.......\...............\.......-....................../..................|.../.........\......
.\....../.........|...................................|-.|../.../...........-.-.............\................-
/-..\/.......-........\../.....-..|..................\................|......./...............................
......../.................-..../.................-...-|.........|............../...........|..................
..|......../.....\......................|.....|/...../.............-.|-...-...|......................-........
......|........|.\.........\............-........-/......./.............../......./......................|...\
....|...............\...../.............../......|......../............|/...|........./...../..........-.\.--.
..|.........|......|.............................|...........-....|...-.............../................/......
.....................|........./............./........................................../.........|...........
.....\........................|../.....................-.......|.-........................../../......-.......
..........................-....../.......\.............................-....\................/................
................................-...../.........//.........-...|../....\..................................-...
...........................-................|/|.||............................................\...\.....|.....
..|..........-................/...................-.......|..................................-...............\
../....-.........-...............................................\.....\...........|-............./.......|...
......\...|......../........................./...........................................|....................
.-..................../...-..|.-..\...../.........-............./..........\..................................
....-....-...........-........-........|......................\................................./\....-.......
..........|...................................\.../....../...-......|../............|......|................\.
.-.|.|.|.........-........-....\.........|......../..-.........../............\......-\.......|.......|.......
........|......../.............|...\.\......../...-........\.......\......-........-......./.../..............
..../..........-............/././.........|.-...........|.........../.........................\-....|.........
........\......................../................-................|..\........./...\.......\.\...............
.............\........|....\....../..........|..\................./...||......./|..\................\.....\...
./.|.................................../...|....................|...................|...../.\............../..
.../....................\..........|.-...............................\.........|....|\./.../.\.\..............
\|........./.\...-......\..............\..........|...........\.|\............/...........-...................
....................../..\...\..........................|-..........-\................\......./.-.............
................................/.....................|././......../............/.\...|.......................
.............................-./............|.............|.-.............../..........|.../................./
...............-........................//........././............/...../...-......-\\........................
-././.........../..-....|.......-......./..................-...........|......./......./....|.................
........../.............................\...-............|.............\..-........../......./.\.../.........\
..................|\..........................|..........|....................|...\...........\...............
.....-.....\../....|.|....|.|........|.-..-........................../.........................-........-.....
.....\......\............./..............-.....|........................................\......|...\........|.
..|......../..................................\..........-.............\..............\......|.....-..........
.\....................................|.|.././.-../-..............................|.|........\........./......
....................-.../.../...../......\....|........./........-../...................|..................-..
\...........|...\....-...-..\....................................-.|./..........................\.............
.........\..........\.................-...........-........-....-.-..................\.-........|.-....\......
..........................................|........|..........................\......\......\.-.|...\../...\..
..-..................\.\..-........................................\.........-..|...../......|................
.../....../......\./.\|.../.-........-............-../...........-.......-.........\.|................-.......
..|\..../.|........................|........-/.........-..|......|..........-.....|.......\.../..-......-.....
............................................................../.................\..|...-./............|...../.
..\.|.....-............-/\.............|.............\...............|....../........../....-/..\../......\...
............................/....-.../...................|.....-........|.../....\........-.....-...|...|.....
../..../.............|..\...||......-..-...................-...........\...-.....\.....|.........||..//.......
............................/.....\..\....-................/..../........\....\.................-|............
...-........-..../..........|.......-...|........|....-.......\...|....../...//...|...........\.......|-......
......./.........|../.........../...\............\................/..|..\.\.....................\...|.........
....-.............../.|.../............\..........--...........................|........./......|.............
............./.................\............/......-................/|.............\./........\..|....\.......
............\.............|..|.|\....-...-|/|...\...........................-....../.......|..................
./...../|...\........\|....-...............\\.........../........-../................................-........
-......-.\...|...\..|.|..../.........-...........|...................-.|..............-../............../.....
..|..........|/......................................\.........|............./.................-..|-..........
..\.......\................\...\....................\............................-......|......\....-.....-...
..||................................-...\.-.....|................./......|..............|.....\...............
..................-......../.....|..\.......--.../...../.\-.............-........................../.........\
-.......\............./............/...|...-.../...........\.................|.....\....\.\....-..../..-......
-............/.......\........................................................\..-.....................\......
.../................................................../.........../....|.........\.....................-......
...................|.......\......././................|..-......\....-.....-|...|.....-.......................
..........................-.......................-.....-......-............\.....\....\.-....................
""".strip().splitlines(False)
WIDTH = len(layout[0])
HEIGHT = len(layout)


# PART 1
def trace_beam(x, y, vx, vy, seen=None) -> set[tuple[int, int]]:
    # coordinates: (→,↓)
    # initial position: [x,y]; initial vector: [vx,vy] (one of the two is always zero)
    energized = set()
    if seen is None:
        seen = set()  # positions and vectors traced so far
    vector = x, y, vx, vy
    while 0 <= y < HEIGHT and 0 <= x < WIDTH:
        energized.add((x, y))
        seen.add(vector)
        if (tile := layout[y][x]) == "\\":
            vx, vy = vy, vx
        elif tile == "/":
            vx, vy = -vy, -vx
        elif (tile == "-" and vy) or (tile == "|" and vx):
            # beam 1, starting from the next tile following the split
            energized = energized.union(trace_beam(x + vy, y + vx, vy, vx, seen))
            # beam 2 continues in the opposite direction
            vx, vy = -vy, -vx
        x, y = x + vx, y + vy
        if (vector := (x, y, vx, vy)) in seen:
            break
    return energized


# PART 2
def find_best_start():
    energizations = []
    for x in range(WIDTH):
        energizations.append(len(trace_beam(x, 0, 0, 1)))
        energizations.append(len(trace_beam(x, HEIGHT - 1, 0, -1)))
    for y in range(HEIGHT):
        energizations.append(len(trace_beam(0, y, 1, 0)))
        energizations.append(len(trace_beam(WIDTH, y, -1, 0)))
    return max(energizations)


if __name__ == '__main__':
    print(f"Number of energized tiles: {len(trace_beam(0, 0, 1, 0))}")
    print(f"Best energization: {find_best_start()}")
